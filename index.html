<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BankSecure - User Activity Dashboard</title>
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <style>
    :root {
      --primary: #2c5aa0;
      --primary-light: #5a8ec9;
      --primary-dark: #1a3c6e;
      --secondary: #4caf50;
      --success: #4caf50;
      --warning: #ff9800;
      --danger: #f44336;
      --dark: #1a1a2e;
      --light: #f8f9fa;
      --gray: #6c757d;
      --glass: rgba(255, 255, 255, 0.15);
      --card-bg: rgba(255, 255, 255, 0.85);
      --sidebar-width: 280px;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
      --glass-blur: blur(10px);
    }

    .dark-mode {
      --primary: #5a8ec9;
      --primary-light: #7ba9db;
      --primary-dark: #2c5aa0;
      --dark: #f8f9fa;
      --light: #1a1a2e;
      --gray: #adb5bd;
      --glass: rgba(26, 26, 46, 0.7);
      --card-bg: rgba(26, 26, 46, 0.85);
      --shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    }

    .glass-effect {
      --glass: rgba(255, 255, 255, 0.2);
      --card-bg: rgba(255, 255, 255, 0.7);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .dark-mode.glass-effect {
      --glass: rgba(26, 26, 46, 0.5);
      --card-bg: rgba(26, 26, 46, 0.6);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background-color: var(--light);
      color: var(--dark);
      transition: var(--transition);
      min-height: 100vh;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-width);
      background: var(--glass);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      border-right: 1px solid rgba(255, 255, 255, 0.1);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      z-index: 100;
      transition: var(--transition);
      overflow-y: auto;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .sidebar-header h2 {
      margin-left: 10px;
      font-weight: 600;
      color: var(--primary);
    }

    .sidebar-menu {
      padding: 20px 0;
    }

    .menu-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      margin: 5px 0;
      cursor: pointer;
      transition: var(--transition);
      border-left: 3px solid transparent;
    }

    .menu-item:hover, .menu-item.active {
      background: rgba(44, 90, 160, 0.1);
      border-left: 3px solid var(--primary);
    }

    .menu-item .material-icons {
      margin-right: 10px;
      font-size: 20px;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 20px;
      transition: var(--transition);
    }

    /* Tab Content */
    .tab-content {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }

    .tab-content.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Top Bar */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      margin-bottom: 20px;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }

    .search-bar {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 8px 12px;
      width: 300px;
    }

    .search-bar input {
      border: none;
      background: transparent;
      margin-left: 8px;
      width: 100%;
      outline: none;
      color: var(--dark);
    }

    .user-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .theme-toggle, .glass-toggle {
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      transition: var(--transition);
    }

    .theme-toggle:hover, .glass-toggle:hover {
      background: rgba(44, 90, 160, 0.1);
    }

    .notification-badge {
      position: relative;
      cursor: pointer;
    }

    .badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      font-weight: bold;
    }

    .user-profile {
      display: flex;
      align-items: center;
      cursor: pointer;
    }

    .user-avatar {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      margin-right: 10px;
      font-weight: 600;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      transition: var(--transition);
      cursor: pointer;
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .stat-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .stat-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
    }

    .stat-value {
      font-size: 28px;
      font-weight: 700;
      margin: 5px 0;
    }

    .stat-title {
      color: var(--gray);
      font-size: 14px;
    }

    .trend {
      display: flex;
      align-items: center;
      font-size: 12px;
      margin-top: 5px;
    }

    .trend.up {
      color: var(--success);
    }

    .trend.down {
      color: var(--danger);
    }

    /* Dashboard Content */
    .dashboard-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .chart-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .card-title {
      font-weight: 600;
      font-size: 18px;
    }

    .card-actions {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .chart-container {
      height: 300px;
      position: relative;
    }

    /* User Logs */
    .user-logs {
      margin-top: 30px;
    }

    .logs-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .filters {
      display: flex;
      gap: 10px;
    }

    .filter-btn {
      background: rgba(44, 90, 160, 0.1);
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: var(--transition);
      color: var(--dark);
      font-size: 14px;
    }

    .filter-btn:hover {
      background: rgba(44, 90, 160, 0.2);
    }

    .filter-btn.active {
      background: var(--primary);
      color: white;
    }

    .filter-btn .material-icons {
      font-size: 16px;
      margin-right: 5px;
    }

    /* Advanced Filters */
    .advanced-filters {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      display: none;
    }

    .advanced-filters.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }

    .filter-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    .filter-label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      color: var(--gray);
    }

    .filter-input, .filter-select {
      width: 100%;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid rgba(44, 90, 160, 0.2);
      background: rgba(255, 255, 255, 0.2);
      color: var(--dark);
      font-family: 'Inter', sans-serif;
      transition: var(--transition);
    }

    .filter-input:focus, .filter-select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(44, 90, 160, 0.2);
    }

    .filter-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 10px;
    }

    /* User Card */
    .user-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      transition: var(--transition);
      border-left: 4px solid transparent;
      cursor: pointer;
      opacity: 0;
      transform: translateY(20px);
      animation: cardEnter 0.4s ease-out forwards;
    }

    @keyframes cardEnter {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .user-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    }

    .user-card.normal {
      border-left-color: var(--success);
    }

    .user-card.warning {
      border-left-color: var(--warning);
    }

    .user-card.alert {
      border-left-color: var(--danger);
    }

    .user-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .user-title {
      font-weight: 600;
      display: flex;
      align-items: center;
    }

    .user-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }

    .user-status.normal {
      background: rgba(76, 175, 80, 0.2);
      color: var(--success);
    }

    .user-status.warning {
      background: rgba(255, 152, 0, 0.2);
      color: var(--warning);
    }

    .user-status.alert {
      background: rgba(244, 67, 54, 0.2);
      color: var(--danger);
    }

    .user-meta {
      display: flex;
      align-items: center;
      color: var(--gray);
      font-size: 14px;
    }

    .user-meta .material-icons {
      font-size: 16px;
      margin-right: 5px;
    }

    .user-body {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .user-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-bottom: 15px;
    }

    .user-stat {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }

    .user-stat-value {
      font-weight: 700;
      margin-bottom: 5px;
    }

    .user-stat-label {
      font-size: 12px;
      color: var(--gray);
    }

    /* Risk Score Gauge */
    .risk-gauge {
      width: 120px;
      height: 120px;
      position: relative;
      margin: 0 auto 15px;
    }

    .gauge-bg {
      fill: none;
      stroke: #eee;
      stroke-width: 10;
    }

    .gauge-fill {
      fill: none;
      stroke: var(--primary);
      stroke-width: 10;
      stroke-linecap: round;
      transform: rotate(-90deg);
      transform-origin: 50% 50%;
      transition: stroke-dashoffset 1s ease-in-out;
    }

    .gauge-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-weight: 700;
      font-size: 24px;
    }

    .gauge-label {
      text-align: center;
      font-size: 14px;
      color: var(--gray);
    }

    /* Low risk score animation */
    .risk-gauge.low-risk .gauge-fill {
      animation: pulseGauge 2s infinite;
    }

    @keyframes pulseGauge {
      0% { stroke: var(--primary); }
      50% { stroke: var(--success); }
      100% { stroke: var(--primary); }
    }

    /* Timeline */
    .timeline {
      position: relative;
      padding-left: 20px;
      margin: 20px 0;
    }

    .timeline::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 2px;
      background: var(--primary);
    }

    .timeline-item {
      position: relative;
      padding-bottom: 20px;
      padding-left: 20px;
    }

    .timeline-item::before {
      content: '';
      position: absolute;
      left: -9px;
      top: 0;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--primary);
    }

    .timeline-time {
      font-size: 12px;
      color: var(--gray);
      margin-bottom: 5px;
    }

    .timeline-content {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 8px;
      padding: 10px;
    }

    .timeline-action {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .timeline-details {
      display: flex;
      gap: 5px;
      font-size: 12px;
    }

    .timeline-detail {
      background: rgba(44, 90, 160, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
    }

    /* Transaction Heatmap */
    .heatmap {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 5px;
      margin-top: 15px;
    }

    .heatmap-cell {
      height: 30px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
      color: white;
      font-weight: 600;
      position: relative;
      overflow: hidden;
    }

    .heatmap-trend {
      position: absolute;
      bottom: 2px;
      right: 2px;
      font-size: 10px;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      animation: fadeIn 0.3s ease-in-out;
    }

    .modal-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 80%;
      max-width: 900px;
      max-height: 80vh;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: var(--shadow);
      padding: 20px;
      display: flex;
      flex-direction: column;
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .modal-title {
      font-weight: 600;
      font-size: 20px;
    }

    .modal-close {
      cursor: pointer;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: var(--transition);
    }

    .modal-close:hover {
      background: rgba(44, 90, 160, 0.1);
    }

    .modal-body {
      flex: 1;
      overflow-y: auto;
      padding-right: 10px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
    }

    .btn {
      padding: 8px 16px;
      border-radius: 8px;
      border: none;
      font-family: 'Inter', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
    }

    .btn-outline {
      background: transparent;
      border: 1px solid var(--primary);
      color: var(--primary);
    }

    .btn-outline:hover {
      background: rgba(44, 90, 160, 0.1);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #d90429;
    }

    /* JSON Viewer */
    .json-viewer {
      font-family: 'Courier New', Courier, monospace;
      font-size: 14px;
      background: rgba(0, 0, 0, 0.05);
      border-radius: 8px;
      padding: 15px;
      max-height: 60vh;
      overflow-y: auto;
    }

    /* Analytics Page */
    .analytics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }

    .analytics-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: var(--shadow);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
    }

    .analytics-card.wide {
      grid-column: span 2;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .dashboard-content, .analytics-grid {
        grid-template-columns: 1fr;
      }
      .analytics-card.wide {
        grid-column: span 1;
      }
    }

    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
        z-index: 1000;
      }
      .sidebar.active {
        transform: translateX(0);
      }
      .main-content {
        margin-left: 0;
      }
      .menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .user-body {
        grid-template-columns: 1fr;
      }
      .user-stats {
        grid-template-columns: repeat(2, 1fr);
      }
      .search-bar {
        width: 200px;
      }
      .modal-content {
        width: 95%;
      }
      .top-bar {
        flex-direction: column;
        gap: 10px;
      }
      .user-actions {
        width: 100%;
        justify-content: space-between;
      }
    }

    @media (max-width: 576px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .search-bar {
        width: 100%;
      }
      .filters {
        flex-wrap: wrap;
      }
      .filter-row {
        flex-direction: column;
        gap: 10px;
      }
      .filter-group {
        min-width: 100%;
      }
    }

    /* Bottom Navbar for Mobile */
    .bottom-navbar {
      display: none;
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: var(--card-bg);
      backdrop-filter: var(--glass-blur);
      -webkit-backdrop-filter: var(--glass-blur);
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
      z-index: 100;
      padding: 10px 0;
    }

    .bottom-navbar .nav-items {
      display: flex;
      justify-content: space-around;
    }

    .bottom-navbar .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: var(--gray);
      font-size: 12px;
      transition: var(--transition);
    }

    .bottom-navbar .nav-item.active {
      color: var(--primary);
    }

    .bottom-navbar .nav-item .material-icons {
      font-size: 24px;
      margin-bottom: 2px;
    }

    @media (max-width: 768px) {
      .bottom-navbar {
        display: block;
      }
      .main-content {
        padding-bottom: 70px;
      }
    }

    /* Animations */
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    .pulse {
      animation: pulse 2s infinite;
    }

    /* Toggle Switch */
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
      margin-left: 10px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 16px;
      width: 16px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked + .slider {
      background-color: var(--primary);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    /* Tooltip */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip .tooltiptext {
      visibility: hidden;
      width: 200px;
      background-color: var(--dark);
      color: var(--light);
      text-align: center;
      border-radius: 6px;
      padding: 5px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      font-size: 12px;
    }

    .tooltip:hover .tooltiptext {
      visibility: visible;
      opacity: 1;
    }

    /* Status icons */
    .status-icon {
      margin-right: 5px;
      font-size: 14px;
    }

    .user-card {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow);
      transition: var(--transition);
      border-left: 4px solid transparent;
    }

    .user-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .user-meta span {
      margin-right: 10px;
      display: inline-flex;
      align-items: center;
    }

    .badge-pill {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: 600;
      background: rgba(44, 90, 160, 0.1);
      margin-left: 6px;
    }

    /* Mini map styling */
    .user-location-map {
      height: 150px;
      border-radius: 8px;
      margin-top: 12px;
      box-shadow: var(--shadow);
    }

  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <span class="material-icons" style="color: var(--primary); font-size: 28px;">account_balance</span>
      <h2>BankSecure</h2>
    </div>
    <div class="sidebar-menu">
      <div class="menu-item active" data-tab="dashboard">
        <span class="material-icons">dashboard</span>
        Dashboard
      </div>
      <div class="menu-item" data-tab="analytics">
        <span class="material-icons">analytics</span>
        Analytics
      </div>
      <div class="menu-item" data-tab="users">
        <span class="material-icons">people</span>
        Users
      </div>
      <div class="menu-item" data-tab="transactions">
        <span class="material-icons">payments</span>
        Transactions
      </div>
      <div class="menu-item" data-tab="reports">
        <span class="material-icons">description</span>
        Reports
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="search-bar">
        <span class="material-icons">search</span>
        <input type="text" placeholder="Search users, accounts, transactions..." id="searchInput">
      </div>
      <div class="user-actions">
        <div class="theme-toggle" id="themeToggle" title="Toggle Dark Mode">
          <span class="material-icons">brightness_4</span>
        </div>
        <div class="glass-toggle" id="glassToggle" title="Toggle Glass Effect">
          <span class="material-icons">blur_on</span>
        </div>
        <div class="notification-badge">
          <span class="material-icons">notifications</span>
          <div class="badge">3</div>
        </div>
        <div class="user-profile">
          <div class="user-avatar">BM</div>
          <span>Bank Manager</span>
        </div>
      </div>
    </div>

    <!-- Dashboard Tab -->
    <div class="tab-content active" id="dashboard-tab">
      <!-- Stats Grid -->
      <div class="stats-grid" id="statsGrid">
        <!-- Stats will be populated by JavaScript -->
      </div>

      <!-- Dashboard Content -->
      <div class="dashboard-content">
        <div class="chart-card">
          <div class="card-header">
            <div class="card-title">Daily Transactions</div>
            <div class="card-actions">
              <button class="filter-btn" id="timeFilter">
                <span class="material-icons">calendar_today</span>
                Last 7 days
              </button>
            </div>
          </div>
          <div class="chart-container">
            <div id="transactionChart"></div>
          </div>
        </div>
        <div class="chart-card">
          <div class="card-header">
            <div class="card-title">Account Types Distribution</div>
            <div class="card-actions">
              <button class="filter-btn active" id="refreshBtn">
                <span class="material-icons">refresh</span>
                Live
              </button>
            </div>
          </div>
          <div class="chart-container">
            <div id="accountChart"></div>
          </div>
        </div>
      </div>

      <!-- User Activity Logs -->
      <div class="user-logs">
        <div class="logs-header">
          <h3>Recent User Activities</h3>
          <div class="filters">
            <button class="filter-btn" id="filterBtn">
              <span class="material-icons">filter_list</span>
              Filters
            </button>
            <button class="filter-btn" id="exportBtn">
              <span class="material-icons">download</span>
              Export
            </button>
            <div class="tooltip">
              <button class="filter-btn active" id="autoRefreshBtn">
                <span class="material-icons">autorenew</span>
                Auto-refresh
                <span id="lastUpdatedTime"></span>
              </button>
              <span class="tooltiptext">Automatically refresh activity data every 30 seconds</span>
            </div>
          </div>
        </div>

        <!-- Advanced Filters -->
        <div class="advanced-filters" id="advancedFilters">
          <div class="filter-row">
            <div class="filter-group">
              <label class="filter-label">Date Range</label>
              <div style="display: flex; gap: 10px;">
                <input type="date" class="filter-input" id="dateFrom">
                <input type="date" class="filter-input" id="dateTo">
              </div>
            </div>
            <div class="filter-group">
              <label class="filter-label">Risk Score</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" class="filter-input" id="riskScoreRange" min="0" max="100" value="30">
                <span id="riskScoreValue">30+</span>
              </div>
            </div>
          </div>
          <div class="filter-row">
            <div class="filter-group">
              <label class="filter-label">Activity Type</label>
              <select class="filter-select" id="activityType">
                <option value="">All Activities</option>
                <option value="login">Login</option>
                <option value="transaction">Transaction</option>
                <option value="account">Account Management</option>
                <option value="support">Support Request</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Status</label>
              <select class="filter-select" id="activityStatus">
                <option value="">All Statuses</option>
                <option value="success">Success</option>
                <option value="failed">Failed</option>
                <option value="pending">Pending</option>
              </select>
            </div>
          </div>
          <div class="filter-actions">
            <button class="btn btn-outline" id="resetFilters">
              <span class="material-icons">clear</span>
              Reset
            </button>
            <button class="btn btn-primary" id="applyFilters">
              <span class="material-icons">check</span>
              Apply Filters
            </button>
          </div>
        </div>

        <!-- User Activity Cards Container -->
        <div id="userCardsContainer">
          <!-- User activity cards will be populated by JavaScript -->
        </div>
      </div>
    </div>

    <!-- Analytics Tab -->
    <div class="tab-content" id="analytics-tab">
      <div class="analytics-grid">
        <div class="analytics-card wide">
          <div class="card-header">
            <div class="card-title">Transaction Volume by Channel</div>
            <div class="card-actions">
              <button class="filter-btn" id="channelTimeFilter">
                <span class="material-icons">calendar_today</span>
                Last 30 days
              </button>
            </div>
          </div>
          <div class="chart-container">
            <div id="channelChart"></div>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-header">
            <div class="card-title">Risk Score Distribution</div>
          </div>
          <div class="chart-container">
            <div id="riskScoreChart"></div>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-header">
            <div class="card-title">Failed Login Attempts</div>
          </div>
          <div class="chart-container">
            <div id="loginChart"></div>
          </div>
        </div>
        <div class="analytics-card wide">
          <div class="card-header">
            <div class="card-title">Average Transaction Value Over Time</div>
            <div class="card-actions">
              <button class="filter-btn" id="transactionTimeFilter">
                <span class="material-icons">calendar_today</span>
                Last 14 days
              </button>
            </div>
          </div>
          <div class="chart-container">
            <div id="transactionValueChart"></div>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-header">
            <div class="card-title">User Activity by Hour</div>
          </div>
          <div class="chart-container">
            <div id="activityHourChart"></div>
          </div>
        </div>
        <div class="analytics-card">
          <div class="card-header">
            <div class="card-title">Account Balances Distribution</div>
          </div>
          <div class="chart-container">
            <div id="balanceChart"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Tab -->
    <div class="tab-content" id="users-tab">
      <div class="user-logs">
        <div class="logs-header">
          <h3>All Users</h3>
          <div class="filters">
            <button class="filter-btn" id="usersFilterBtn">
              <span class="material-icons">filter_list</span>
              Filters
            </button>
            <button class="filter-btn" id="usersExportBtn">
              <span class="material-icons">download</span>
              Export
            </button>
            <button class="btn btn-primary" id="addUserBtn">
              <span class="material-icons">person_add</span>
              Add User
            </button>
          </div>
        </div>

        <!-- Advanced Filters -->
        <div class="advanced-filters" id="usersAdvancedFilters">
          <div class="filter-row">
            <div class="filter-group">
              <label class="filter-label">Account Creation Date</label>
              <div style="display: flex; gap: 10px;">
                <input type="date" class="filter-input" id="usersDateFrom">
                <input type="date" class="filter-input" id="usersDateTo">
              </div>
            </div>
            <div class="filter-group">
              <label class="filter-label">Risk Score</label>
              <div style="display: flex; gap: 10px; align-items: center;">
                <input type="range" class="filter-input" id="usersRiskScoreRange" min="0" max="100" value="30">
                <span id="usersRiskScoreValue">30+</span>
              </div>
            </div>
          </div>
          <div class="filter-row">
            <div class="filter-group">
              <label class="filter-label">Account Status</label>
              <select class="filter-select" id="usersStatus">
                <option value="">All Statuses</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
                <option value="locked">Locked</option>
                <option value="suspended">Suspended</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Account Type</label>
              <select class="filter-select" id="usersAccountType">
                <option value="">All Types</option>
                <option value="checking">Checking</option>
                <option value="savings">Savings</option>
                <option value="business">Business</option>
                <option value="premium">Premium</option>
              </select>
            </div>
          </div>
          <div class="filter-actions">
            <button class="btn btn-outline" id="usersResetFilters">
              <span class="material-icons">clear</span>
              Reset
            </button>
            <button class="btn btn-primary" id="usersApplyFilters">
              <span class="material-icons">check</span>
              Apply Filters
            </button>
          </div>
        </div>

        <!-- Users Table -->
        <div class="chart-card">
          <div class="card-header">
            <div class="card-title">User List</div>
            <div class="card-actions">
              <div class="tooltip">
                <button class="filter-btn" id="selectAllBtn">
                  <span class="material-icons">select_all</span>
                  Select All
                </button>
                <span class="tooltiptext">Select all filtered users</span>
              </div>
            </div>
          </div>
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: rgba(44, 90, 160, 0.1);">
                  <th style="padding: 12px 15px; text-align: left;">User ID</th>
                  <th style="padding: 12px 15px; text-align: left;">Name</th>
                  <th style="padding: 12px 15px; text-align: left;">Account Type</th>
                  <th style="padding: 12px 15px; text-align: left;">Risk Score</th>
                  <th style="padding: 12px 15px; text-align: left;">Status</th>
                  <th style="padding: 12px 15px; text-align: left;">Balance</th>
                  <th style="padding: 12px 15px; text-align: left;">Last Activity</th>
                  <th style="padding: 12px 15px; text-align: left;">Actions</th>
                </tr>
              </thead>
              <tbody id="usersTableBody">
                <!-- Users will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="font-size: 14px; color: var(--gray);">
              Showing <span id="showingCount">0</span> of <span id="totalCount">0</span> users
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-outline" id="prevPageBtn" disabled>
                <span class="material-icons">chevron_left</span>
                Previous
              </button>
              <button class="btn btn-outline" id="nextPageBtn" disabled>
                Next
                <span class="material-icons">chevron_right</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Transactions Tab -->
    <div class="tab-content" id="transactions-tab">
      <div class="user-logs">
        <div class="logs-header">
          <h3>Transaction Monitoring</h3>
          <div class="filters">
            <button class="filter-btn" id="transactionsFilterBtn">
              <span class="material-icons">filter_list</span>
              Filters
            </button>
            <button class="filter-btn" id="transactionsExportBtn">
              <span class="material-icons">download</span>
              Export
            </button>
            <button class="btn btn-primary" id="flagTransactionBtn">
              <span class="material-icons">flag</span>
              Flag Suspicious
            </button>
          </div>
        </div>

        <!-- Advanced Filters -->
        <div class="advanced-filters" id="transactionsAdvancedFilters">
          <div class="filter-row">
            <div class="filter-group">
              <label class="filter-label">Transaction Date</label>
              <div style="display: flex; gap: 10px;">
                <input type="date" class="filter-input" id="transactionsDateFrom">
                <input type="date" class="filter-input" id="transactionsDateTo">
              </div>
            </div>
            <div class="filter-group">
              <label class="filter-label">Amount Range</label>
              <div style="display: flex; gap: 10px;">
                <input type="number" class="filter-input" id="amountFrom" placeholder="Min">
                <input type="number" class="filter-input" id="amountTo" placeholder="Max">
              </div>
            </div>
          </div>
          <div class="filter-row">
            <div class="filter-group">
              <label class="filter-label">Transaction Type</label>
              <select class="filter-select" id="transactionType">
                <option value="">All Types</option>
                <option value="deposit">Deposit</option>
                <option value="withdrawal">Withdrawal</option>
                <option value="transfer">Transfer</option>
                <option value="payment">Payment</option>
              </select>
            </div>
            <div class="filter-group">
              <label class="filter-label">Status</label>
              <select class="filter-select" id="transactionStatus">
                <option value="">All Statuses</option>
                <option value="completed">Completed</option>
                <option value="pending">Pending</option>
                <option value="failed">Failed</option>
                <option value="flagged">Flagged</option>
              </select>
            </div>
          </div>
          <div class="filter-actions">
            <button class="btn btn-outline" id="transactionsResetFilters">
              <span class="material-icons">clear</span>
              Reset
            </button>
            <button class="btn btn-primary" id="transactionsApplyFilters">
              <span class="material-icons">check</span>
              Apply Filters
            </button>
          </div>
        </div>

        <!-- Transactions Table -->
        <div class="chart-card">
          <div class="card-header">
            <div class="card-title">Transaction List</div>
            <div class="card-actions">
              <div class="tooltip">
                <button class="filter-btn" id="selectAllTransactionsBtn">
                  <span class="material-icons">select_all</span>
                  Select All
                </button>
                <span class="tooltiptext">Select all filtered transactions</span>
              </div>
            </div>
          </div>
          <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead>
                <tr style="background: rgba(44, 90, 160, 0.1);">
                  <th style="padding: 12px 15px; text-align: left;"></th>
                  <th style="padding: 12px 15px; text-align: left;">Transaction ID</th>
                  <th style="padding: 12px 15px; text-align: left;">User</th>
                  <th style="padding: 12px 15px; text-align: left;">Type</th>
                  <th style="padding: 12px 15px; text-align: left;">Amount</th>
                  <th style="padding: 12px 15px; text-align: left;">From/To</th>
                  <th style="padding: 12px 15px; text-align: left;">Date</th>
                  <th style="padding: 12px 15px; text-align: left;">Status</th>
                  <th style="padding: 12px 15px; text-align: left;">Actions</th>
                </tr>
              </thead>
              <tbody id="transactionsTableBody">
                <!-- Transactions will be populated by JavaScript -->
              </tbody>
            </table>
          </div>
          <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255, 255, 255, 0.1);">
            <div style="font-size: 14px; color: var(--gray);">
              Showing <span id="transactionsShowingCount">0</span> of <span id="transactionsTotalCount">0</span> transactions
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-outline" id="transactionsPrevPageBtn" disabled>
                <span class="material-icons">chevron_left</span>
                Previous
              </button>
              <button class="btn btn-outline" id="transactionsNextPageBtn" disabled>
                Next
                <span class="material-icons">chevron_right</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Reports Tab -->
    <div class="tab-content" id="reports-tab">
      <div class="user-logs">
        <div class="logs-header">
          <h3>Reports & Analytics</h3>
          <div class="filters">
            <button class="btn btn-primary" id="generateReportBtn">
              <span class="material-icons">summarize</span>
              Generate Report
            </button>
            <button class="filter-btn" id="scheduleReportBtn">
              <span class="material-icons">schedule</span>
              Schedule Report
            </button>
          </div>
        </div>

        <div class="analytics-grid">
          <div class="analytics-card">
            <div class="card-header">
              <div class="card-title">Daily Activity Report</div>
              <div class="card-actions">
                <button class="filter-btn">
                  <span class="material-icons">download</span>
                  PDF
                </button>
              </div>
            </div>
            <div style="padding: 15px;">
              <p>Summary of all user activities for the current day.</p>
              <div style="margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Total Logins:</span>
                  <span style="font-weight: 600;">1,243</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Transactions Processed:</span>
                  <span style="font-weight: 600;">856</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Failed Attempts:</span>
                  <span style="font-weight: 600; color: var(--danger);">23</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span>New Accounts:</span>
                  <span style="font-weight: 600;">12</span>
                </div>
              </div>
            </div>
          </div>

          <div class="analytics-card">
            <div class="card-header">
              <div class="card-title">Monthly Financial Report</div>
              <div class="card-actions">
                <button class="filter-btn">
                  <span class="material-icons">download</span>
                  PDF
                </button>
              </div>
            </div>
            <div style="padding: 15px;">
              <p>Financial overview for the current month.</p>
              <div style="margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Total Deposits:</span>
                  <span style="font-weight: 600;">$2.45M</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Total Withdrawals:</span>
                  <span style="font-weight: 600;">$1.87M</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Net Flow:</span>
                  <span style="font-weight: 600; color: var(--success);">+$580K</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span>Fee Revenue:</span>
                  <span style="font-weight: 600;">$24,560</span>
                </div>
              </div>
            </div>
          </div>

          <div class="analytics-card">
            <div class="card-header">
              <div class="card-title">Security Report</div>
              <div class="card-actions">
                <button class="filter-btn">
                  <span class="material-icons">download</span>
                  PDF
                </button>
              </div>
            </div>
            <div style="padding: 15px;">
              <p>Security incidents and risk assessment.</p>
              <div style="margin-top: 15px;">
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Flagged Transactions:</span>
                  <span style="font-weight: 600;">18</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Suspicious Logins:</span>
                  <span style="font-weight: 600;">7</span>
                </div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <span>Accounts Locked:</span>
                  <span style="font-weight: 600;">3</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                  <span>Risk Score Avg:</span>
                  <span style="font-weight: 600;">24/100</span>
                </div>
              </div>
            </div>
          </div>

          <div class="analytics-card wide">
            <div class="card-header">
              <div class="card-title">Custom Report Builder</div>
            </div>
            <div style="padding: 15px;">
              <div class="filter-row">
                <div class="filter-group">
                  <label class="filter-label">Report Type</label>
                  <select class="filter-select">
                    <option value="activity">User Activity</option>
                    <option value="financial">Financial</option>
                    <option value="security">Security</option>
                    <option value="custom">Custom</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label class="filter-label">Date Range</label>
                  <select class="filter-select">
                    <option value="today">Today</option>
                    <option value="yesterday">Yesterday</option>
                    <option value="week">This Week</option>
                    <option value="month">This Month</option>
                    <option value="quarter">This Quarter</option>
                    <option value="year">This Year</option>
                    <option value="custom">Custom Range</option>
                  </select>
                </div>
              </div>
              <div class="filter-row">
                <div class="filter-group">
                  <label class="filter-label">Format</label>
                  <select class="filter-select">
                    <option value="pdf">PDF</option>
                    <option value="excel">Excel</option>
                    <option value="csv">CSV</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label class="filter-label">Include Charts</label>
                  <label class="switch">
                    <input type="checkbox" checked>
                    <span class="slider"></span>
                  </label>
                </div>
              </div>
              <div class="filter-actions">
                <button class="btn btn-primary">
                  <span class="material-icons">summarize</span>
                  Generate Report
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bottom Navbar for Mobile -->
  <div class="bottom-navbar">
    <div class="nav-items">
      <a href="#" class="nav-item active" data-tab="dashboard">
        <span class="material-icons">dashboard</span>
        Dashboard
      </a>
      <a href="#" class="nav-item" data-tab="analytics">
        <span class="material-icons">analytics</span>
        Analytics
      </a>
      <a href="#" class="nav-item" data-tab="users">
        <span class="material-icons">people</span>
        Users
      </a>
      <a href="#" class="nav-item" data-tab="transactions">
        <span class="material-icons">payments</span>
        Transactions
      </a>
      <a href="#" class="nav-item" data-tab="reports">
        <span class="material-icons">description</span>
        Reports
      </a>
    </div>
  </div>

  <!-- User Details Modal -->
  <div class="modal" id="userModal">
    <div class="modal-content">
      <div class="modal-header">
        <div class="modal-title">User Details</div>
        <div class="modal-close" id="modalClose">
          <span class="material-icons">close</span>
        </div>
      </div>
      <div class="modal-body">
        <div class="json-viewer" id="userJsonViewer"></div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-outline" id="copyJsonBtn">
          <span class="material-icons">content_copy</span>
          Copy JSON
        </button>
        <button class="btn btn-primary" id="closeModalBtn">
          Close
        </button>
      </div>
    </div>
  </div>

  <script>
    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    const glassToggle = document.getElementById('glassToggle');
    const body = document.body;
    
    // Check for saved theme preference
    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      body.classList.add('dark-mode');
      themeToggle.innerHTML = '<span class="material-icons">brightness_7</span>';
    }
    
    // Check for glass effect preference
    const savedGlassEffect = localStorage.getItem('glassEffect');
    if (savedGlassEffect === 'true') {
      body.classList.add('glass-effect');
      glassToggle.innerHTML = '<span class="material-icons">blur_off</span>';
    }
    
    themeToggle.addEventListener('click', () => {
      body.classList.toggle('dark-mode');
      const isDark = body.classList.contains('dark-mode');
      
      // Save preference
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      
      // Update icon
      themeToggle.innerHTML = isDark 
        ? '<span class="material-icons">brightness_7</span>' 
        : '<span class="material-icons">brightness_4</span>';
    });
    
    glassToggle.addEventListener('click', () => {
      body.classList.toggle('glass-effect');
      const hasGlassEffect = body.classList.contains('glass-effect');
      
      // Save preference
      localStorage.setItem('glassEffect', hasGlassEffect ? 'true' : 'false');
      
      // Update icon
      glassToggle.innerHTML = hasGlassEffect 
        ? '<span class="material-icons">blur_off</span>' 
        : '<span class="material-icons">blur_on</span>';
    });

    // Tab Navigation
    const menuItems = document.querySelectorAll('.menu-item');
    const tabContents = document.querySelectorAll('.tab-content');
    const navItems = document.querySelectorAll('.nav-item');
    
    function setActiveTab(tabId) {
      // Update menu items
      menuItems.forEach(item => {
        item.classList.toggle('active', item.dataset.tab === tabId);
      });
      
      // Update tab contents
      tabContents.forEach(content => {
        content.classList.toggle('active', content.id === `${tabId}-tab`);
      });
      
      // Update bottom nav items
      navItems.forEach(item => {
        item.classList.toggle('active', item.dataset.tab === tabId);
      });
      
      // Store active tab
      localStorage.setItem('activeTab', tabId);
      
      // Load data if needed
      if (tabId === 'analytics') {
        loadAnalyticsData();
      } else if (tabId === 'users') {
        loadUsersTable();
      } else if (tabId === 'transactions') {
        loadTransactionsTable();
      }
    }
    
    // Add click event to menu items
    menuItems.forEach(item => {
      item.addEventListener('click', () => {
        setActiveTab(item.dataset.tab);
      });
    });
    
    // Add click event to bottom nav items
    navItems.forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        setActiveTab(item.dataset.tab);
      });
    });
    
    // Check for saved active tab
    const savedActiveTab = localStorage.getItem('activeTab') || 'dashboard';
    setActiveTab(savedActiveTab);

    // Global variables
    let allUsers = [];
    let filteredUsers = [];
    let allTransactions = [];
    let filteredTransactions = [];
    let autoRefreshInterval;
    let currentPage = 1;
    const itemsPerPage = 10;
    let selectedUsers = new Set();
    let selectedTransactions = new Set();

    // Initialize the dashboard
    document.addEventListener('DOMContentLoaded', function() {
      loadUserData();
      loadTransactionData();
      setupEventListeners();
      
      // Set up auto-refresh
      startAutoRefresh();
      
      // Set up keyboard shortcuts
      setupKeyboardShortcuts();
      
      // Update last updated time
      updateLastUpdatedTime();
    });

    // Update last updated time
    function updateLastUpdatedTime() {
      const now = new Date();
      const timeString = now.toLocaleTimeString();
      document.getElementById('lastUpdatedTime').textContent = `Last updated: ${timeString}`;
    }

    // Load user data from the server
    async function loadUserData() {
      try {
        // In a real application, this would fetch from your API
        // For demo purposes, we'll generate sample data
        const sampleUsers = generateSampleUserData();
        allUsers = sampleUsers;
        filteredUsers = [...sampleUsers];
        
        updateStats(sampleUsers);
        updateCharts(sampleUsers);
        renderUserCards(sampleUsers);
        
        // If on analytics tab, load analytics data
        if (document.querySelector('.tab-content.active').id === 'analytics-tab') {
          loadAnalyticsData();
        }
        
        // If on users tab, load users table
        if (document.querySelector('.tab-content.active').id === 'users-tab') {
          loadUsersTable();
        }
        
        // Update last updated time
        updateLastUpdatedTime();
        
        // Cache the data
        localStorage.setItem('cachedUsers', JSON.stringify(sampleUsers));
        localStorage.setItem('lastUpdated', new Date().getTime());
      } catch (error) {
        console.error('Error loading user data:', error);
        
        // Try to load cached data if available
        const cachedUsers = localStorage.getItem('cachedUsers');
        if (cachedUsers) {
          allUsers = JSON.parse(cachedUsers);
          filteredUsers = [...allUsers];
          updateStats(allUsers);
          updateCharts(allUsers);
          renderUserCards(allUsers);
          
          Swal.fire({
            icon: 'warning',
            title: 'Using Cached Data',
            text: 'Failed to fetch new data. Displaying cached user information.',
          });
        } else {
          Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'Failed to load user data. Please try again later.',
          });
        }
      }
    }

    // Load transaction data from the server
    async function loadTransactionData() {
      try {
        // In a real application, this would fetch from your API
        // For demo purposes, we'll generate sample data
        const sampleTransactions = generateSampleTransactionData();
        allTransactions = sampleTransactions;
        filteredTransactions = [...sampleTransactions];
        
        // If on transactions tab, load transactions table
        if (document.querySelector('.tab-content.active').id === 'transactions-tab') {
          loadTransactionsTable();
        }
        
        // Cache the data
        localStorage.setItem('cachedTransactions', JSON.stringify(sampleTransactions));
      } catch (error) {
        console.error('Error loading transaction data:', error);
        
        // Try to load cached data if available
        const cachedTransactions = localStorage.getItem('cachedTransactions');
        if (cachedTransactions) {
          allTransactions = JSON.parse(cachedTransactions);
          filteredTransactions = [...allTransactions];
          
          if (document.querySelector('.tab-content.active').id === 'transactions-tab') {
            loadTransactionsTable();
          }
        }
      }
    }

    // Generate sample user data for demonstration
    function generateSampleUserData() {
      const users = [];
      const firstNames = ['John', 'Jane', 'Robert', 'Emily', 'Michael', 'Sarah', 'David', 'Lisa', 'James', 'Maria'];
      const lastNames = ['Smith', 'Johnson', 'Williams', 'Brown', 'Jones', 'Garcia', 'Miller', 'Davis', 'Rodriguez', 'Martinez'];
      const accountTypes = ['Checking', 'Savings', 'Business', 'Premium'];
      const statuses = ['active', 'inactive', 'locked', 'suspended'];
      
      for (let i = 1; i <= 50; i++) {
        const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
        const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
        const accountType = accountTypes[Math.floor(Math.random() * accountTypes.length)];
        const status = statuses[Math.floor(Math.random() * statuses.length)];
        const riskScore = Math.floor(Math.random() * 100);
        const balance = Math.floor(Math.random() * 100000) + 1000;
        const lastActivity = new Date(Date.now() - Math.floor(Math.random() * 30 * 24 * 60 * 60 * 1000));
        
        users.push({
          id: `USER${i.toString().padStart(4, '0')}`,
          name: `${firstName} ${lastName}`,
          email: `${firstName.toLowerCase()}.${lastName.toLowerCase()}@example.com`,
          accountType,
          status,
          riskScore,
          balance,
          lastActivity: lastActivity.toISOString(),
          accounts: Math.floor(Math.random() * 3) + 1,
          transactions: Math.floor(Math.random() * 100),
          loginAttempts: Math.floor(Math.random() * 10),
          location: `${['New York', 'London', 'Tokyo', 'Sydney', 'Berlin'][Math.floor(Math.random() * 5)]}`,
          device: `${['iOS', 'Android', 'Web'][Math.floor(Math.random() * 3)]}`
        });
      }
      
      return users;
    }

    // Generate sample transaction data for demonstration
    function generateSampleTransactionData() {
      const transactions = [];
      const types = ['deposit', 'withdrawal', 'transfer', 'payment'];
      const statuses = ['completed', 'pending', 'failed', 'flagged'];
      const users = allUsers.length > 0 ? allUsers : generateSampleUserData();
      
      for (let i = 1; i <= 200; i++) {
        const user = users[Math.floor(Math.random() * users.length)];
        const type = types[Math.floor(Math.random() * types.length)];
        const status = statuses[Math.floor(Math.random() * statuses.length)];
        const amount = Math.floor(Math.random() * 10000) + 10;
        const date = new Date(Date.now() - Math.floor(Math.random() * 7 * 24 * 60 * 60 * 1000));
        
        // Generate from/to based on transaction type
        let from, to;
        if (type === 'deposit') {
          from = 'External Source';
          to = user.name;
        } else if (type === 'withdrawal') {
          from = user.name;
          to = 'External Destination';
        } else {
          from = user.name;
          to = users[Math.floor(Math.random() * users.length)].name;
        }
        
        transactions.push({
          id: `TXN${i.toString().padStart(6, '0')}`,
          userId: user.id,
          userName: user.name,
          type,
          status,
          amount,
          from,
          to,
          date: date.toISOString(),
          location: `${['Online', 'Branch', 'ATM'][Math.floor(Math.random() * 3)]}`,
          channel: `${['Mobile App', 'Website', 'In-Person'][Math.floor(Math.random() * 3)]}`
        });
      }
      
      return transactions;
    }

    // Update stats cards
    function updateStats(users) {
      const statsGrid = document.getElementById('statsGrid');
      
      // Calculate stats
      const totalUsers = users.length;
      const activeUsers = users.filter(u => u.status === 'active').length;
      const totalBalance = users.reduce((sum, user) => sum + user.balance, 0);
      const avgRiskScore = users.reduce((sum, user) => sum + user.riskScore, 0) / totalUsers;
      
      // Create stats HTML
      statsGrid.innerHTML = `
        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-title">Total Users</div>
              <div class="stat-value" id="totalUsersCounter">0</div>
            </div>
            <div class="stat-icon" style="background: var(--primary);">
              <span class="material-icons">people</span>
            </div>
          </div>
          <div class="trend up">
            <span class="material-icons">trending_up</span>
            <span>${Math.floor(totalUsers * 0.05)} new this week</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-title">Active Users</div>
              <div class="stat-value" id="activeUsersCounter">0</div>
            </div>
            <div class="stat-icon" style="background: var(--success);">
              <span class="material-icons">person</span>
            </div>
          </div>
          <div class="trend up">
            <span class="material-icons">trending_up</span>
            <span>${Math.floor(activeUsers * 0.08)}% from last week</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-title">Total Balance</div>
              <div class="stat-value" id="totalBalanceCounter">$0</div>
            </div>
            <div class="stat-icon" style="background: var(--primary-dark);">
              <span class="material-icons">account_balance</span>
            </div>
          </div>
          <div class="trend up">
            <span class="material-icons">trending_up</span>
            <span>${Math.floor(totalBalance * 0.02)}% from last week</span>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-header">
            <div>
              <div class="stat-title">Avg. Risk Score</div>
              <div class="stat-value" id="avgRiskScoreCounter">0</div>
            </div>
            <div class="stat-icon" style="background: var(--warning);">
              <span class="material-icons">security</span>
            </div>
          </div>
          <div class="trend down">
            <span class="material-icons">trending_down</span>
            <span>${Math.floor(avgRiskScore * 0.05)}% from last week</span>
          </div>
        </div>
      `;
      
      // Animate counters
      animateCounter('totalUsersCounter', totalUsers, 0);
      animateCounter('activeUsersCounter', activeUsers, 0);
      animateCounter('totalBalanceCounter', totalBalance, 0, '$');
      animateCounter('avgRiskScoreCounter', Math.round(avgRiskScore), 0);
    }

    // Animate counter
    function animateCounter(elementId, target, current, prefix = '') {
      const element = document.getElementById(elementId);
      const increment = target / 50; // Adjust speed of animation
      
      const timer = setInterval(() => {
        current += increment;
        if (current >= target) {
          clearInterval(timer);
          current = target;
        }
        
        if (prefix === '$') {
          element.textContent = prefix + Math.round(current).toLocaleString();
        } else {
          element.textContent = prefix + Math.round(current);
        }
      }, 20);
    }

    // Update charts
    let accountChartInstance;
    let transactionChartInstance;

    function updateCharts(users) {
      // Transaction Activity Chart
      const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      const transactionCounts = [120, 190, 170, 210, 180, 150, 200];
      const failedCounts = [12, 9, 7, 11, 8, 5, 10];
      
      const transactionChartOptions = {
        series: [{
          name: 'Successful Transactions',
          data: transactionCounts
        }, {
          name: 'Failed Transactions',
          data: failedCounts
        }],
        chart: {
          height: 300,
          type: 'area',
          toolbar: {
            show: false
          },
          animations: {
            enabled: true,
            easing: 'easeinout',
            speed: 800
          }
        },
        colors: ['#4caf50', '#f44336'],
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: 2
        },
        fill: {
          type: 'gradient',
          gradient: {
            shadeIntensity: 1,
            opacityFrom: 0.7,
            opacityTo: 0.3,
            stops: [0, 90, 100]
          }
        },
        xaxis: {
          categories: days
        },
        tooltip: {
          shared: true,
          intersect: false
        },
        legend: {
          position: 'top'
        }
      };
      
      if (transactionChartInstance) transactionChartInstance.destroy();
        document.querySelector("#transactionChart").innerHTML = '';
        transactionChartInstance = new ApexCharts(document.querySelector("#transactionChart"), transactionChartOptions);
        transactionChartInstance.render();

      
      // Account Types Chart
      const accountTypeCounts = {};
      users.forEach(user => {
        accountTypeCounts[user.accountType] = (accountTypeCounts[user.accountType] || 0) + 1;
      });
      
      const accountChartOptions = {
        series: Object.values(accountTypeCounts),
        chart: {
          type: 'donut',
          height: 300
        },
        colors: ['#2c5aa0', '#4caf50', '#ff9800', '#f44336'],
        labels: Object.keys(accountTypeCounts),
        responsive: [{
          breakpoint: 480,
          options: {
            chart: {
              width: 200
            },
            legend: {
              position: 'bottom'
            }
          }
        }],
        plotOptions: {
          pie: {
            donut: {
              size: '70%'
            }
          }
        },
        dataLabels: {
          enabled: false
        },
        legend: {
          position: 'right'
        },
        tooltip: {
          y: {
            formatter: function(value) {
              const total = Object.values(accountTypeCounts).reduce((a, b) => a + b, 0);
              const percentage = Math.round((value / total) * 100);
              return `${value} users (${percentage}%)`;
            }
          }
        }
      };
      
      if (accountChartInstance) accountChartInstance.destroy();
        document.querySelector("#accountChart").innerHTML = '';
        accountChartInstance = new ApexCharts(document.querySelector("#accountChart"), accountChartOptions);
        accountChartInstance.render();

    }

    // Load analytics data
    function loadAnalyticsData() {
      // Transaction Volume by Channel
      const channelCounts = {
        'Mobile App': 0,
        'Website': 0,
        'In-Person': 0,
        'ATM': 0
      };
      
      allTransactions.forEach(transaction => {
        if (channelCounts.hasOwnProperty(transaction.channel)) {
          channelCounts[transaction.channel]++;
        }
      });
      
      const channelChartOptions = {
        series: [{
          name: 'Transactions',
          data: Object.values(channelCounts)
        }],
        chart: {
          type: 'bar',
          height: 300,
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            borderRadius: 4,
            horizontal: false,
          }
        },
        dataLabels: {
          enabled: false
        },
        xaxis: {
          categories: Object.keys(channelCounts)
        },
        colors: ['#2c5aa0'],
        tooltip: {
          y: {
            formatter: function(value) {
              return `${value} transactions`;
            }
          }
        }
      };
      
      const channelChart = new ApexCharts(document.querySelector("#channelChart"), channelChartOptions);
      channelChart.render();
      
      // Risk Score Distribution
      const riskScoreBins = Array(10).fill(0);
      allUsers.forEach(user => {
        const bin = Math.floor(user.riskScore / 10);
        riskScoreBins[bin === 10 ? 9 : bin]++;
      });
      
      const riskScoreChartOptions = {
        series: [{
          name: 'Users',
          data: riskScoreBins
        }],
        chart: {
          type: 'bar',
          height: 300,
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            borderRadius: 4,
            horizontal: true,
          }
        },
        dataLabels: {
          enabled: false
        },
        xaxis: {
          categories: ['0-10', '10-20', '20-30', '30-40', '40-50', '50-60', '60-70', '70-80', '80-90', '90-100']
        },
        colors: ['#5a8ec9'],
        tooltip: {
          y: {
            formatter: function(value) {
              return `${value} users`;
            }
          }
        }
      };
      
      const riskScoreChart = new ApexCharts(document.querySelector("#riskScoreChart"), riskScoreChartOptions);
      riskScoreChart.render();
      
      // Failed Login Attempts
      const failedLogins = allUsers.reduce((sum, user) => sum + user.loginAttempts, 0);
      const successfulLogins = allUsers.length * 10; // Assuming 10 logins per user on average
      
      const loginChartOptions = {
        series: [successfulLogins, failedLogins],
        chart: {
          type: 'pie',
          height: 300
        },
        labels: ['Successful Logins', 'Failed Logins'],
        colors: ['#4caf50', '#f44336'],
        responsive: [{
          breakpoint: 480,
          options: {
            chart: {
              width: 200
            },
            legend: {
              position: 'bottom'
            }
          }
        }],
        dataLabels: {
          enabled: false
        },
        legend: {
          position: 'right'
        }
      };
      
      const loginChart = new ApexCharts(document.querySelector("#loginChart"), loginChartOptions);
      loginChart.render();
      
      // Average Transaction Value Over Time
      const last14Days = Array(14).fill().map((_, i) => {
        const date = new Date();
        date.setDate(date.getDate() - (13 - i));
        return date;
      });
      
      const avgTransactionValues = last14Days.map(date => {
        const dayTransactions = allTransactions.filter(t => {
          const transactionDate = new Date(t.date);
          return transactionDate.toDateString() === date.toDateString();
        });
        
        if (dayTransactions.length === 0) return 0;
        return dayTransactions.reduce((sum, t) => sum + t.amount, 0) / dayTransactions.length;
      });
      
      const transactionValueChartOptions = {
        series: [{
          name: 'Average Transaction Value',
          data: avgTransactionValues
        }],
        chart: {
          height: 300,
          type: 'line',
          zoom: {
            enabled: false
          },
          toolbar: {
            show: false
          }
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          curve: 'smooth',
          width: 3
        },
        colors: ['#2c5aa0'],
        xaxis: {
          categories: last14Days.map(date => date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })),
        },
        yaxis: {
          min: 0
        },
        tooltip: {
          y: {
            formatter: function(value) {
              return `$${value.toFixed(2)}`;
            }
          }
        }
      };
      
      const transactionValueChart = new ApexCharts(document.querySelector("#transactionValueChart"), transactionValueChartOptions);
      transactionValueChart.render();
      
      // User Activity by Hour
      const activityByHour = Array(24).fill(0);
      allUsers.forEach(user => {
        // Simulate activity hours based on last activity
        const activityHour = new Date(user.lastActivity).getHours();
        activityByHour[activityHour]++;
      });
      
      const activityHourChartOptions = {
        series: [{
          name: 'User Activity',
          data: activityByHour
        }],
        chart: {
          type: 'bar',
          height: 300,
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            borderRadius: 4,
            horizontal: false,
          }
        },
        dataLabels: {
          enabled: false
        },
        xaxis: {
          categories: Array(24).fill().map((_, i) => `${i}:00`)
        },
        colors: ['#ff9800'],
        tooltip: {
          y: {
            formatter: function(value) {
              return `${value} users`;
            }
          }
        }
      };
      
      const activityHourChart = new ApexCharts(document.querySelector("#activityHourChart"), activityHourChartOptions);
      activityHourChart.render();
      
      // Account Balances Distribution
      const balanceBins = Array(5).fill(0).map((_, i) => {
        const min = i * 20000;
        const max = (i + 1) * 20000;
        return allUsers.filter(user => user.balance >= min && user.balance < max).length;
      });
      
      const balanceChartOptions = {
        series: [{
          name: 'Users',
          data: balanceBins
        }],
        chart: {
          type: 'bar',
          height: 300,
          toolbar: {
            show: false
          }
        },
        plotOptions: {
          bar: {
            borderRadius: 4,
            horizontal: false,
          }
        },
        dataLabels: {
          enabled: false
        },
        xaxis: {
          categories: ['$0-20K', '$20-40K', '$40-60K', '$60-80K', '$80K+']
        },
        colors: ['#4caf50'],
        tooltip: {
          y: {
            formatter: function(value) {
              return `${value} users`;
            }
          }
        }
      };
      
      const balanceChart = new ApexCharts(document.querySelector("#balanceChart"), balanceChartOptions);
      balanceChart.render();
    }

    // Load users table
    function loadUsersTable(filtered = false) {
      const usersToDisplay = filtered ? filteredUsers : allUsers;
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, usersToDisplay.length);
      const paginatedUsers = usersToDisplay.slice(startIndex, endIndex);
      
      const tableBody = document.getElementById('usersTableBody');
      tableBody.innerHTML = '';
      
      paginatedUsers.forEach(user => {
        let statusClass = 'normal';
        let statusText = 'Normal';
        let statusIcon = '🟢';
        
        if (user.riskScore > 70) {
          statusClass = 'alert';
          statusText = 'High Risk';
          statusIcon = '🔴';
        } else if (user.riskScore > 40) {
          statusClass = 'warning';
          statusText = 'Medium Risk';
          statusIcon = '🟡';
        }
        
        const lastActivity = new Date(user.lastActivity);
        const formattedDate = lastActivity.toLocaleDateString();
        
        const row = document.createElement('tr');
        row.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
        row.style.transition = 'var(--transition)';
        row.innerHTML = `
          <td style="padding: 12px 15px;">${user.id}</td>
          <td style="padding: 12px 15px;">
            <div>${user.name}</div>
            <div style="font-size: 12px; color: var(--gray);">${user.email}</div>
          </td>
          <td style="padding: 12px 15px;">${user.accountType}</td>
          <td style="padding: 12px 15px;">
            <div style="font-weight: 600; color: ${user.riskScore <= 40 ? 'var(--success)' : user.riskScore <= 70 ? 'var(--warning)' : 'var(--danger)'}">
              ${user.riskScore}
            </div>
          </td>
          <td style="padding: 12px 15px;">
            <span class="user-status ${statusClass}">
              <span class="status-icon">${statusIcon}</span>
              ${statusText}
            </span>
          </td>
          <td style="padding: 12px 15px;">
            $${user.balance.toLocaleString()}
          </td>
          <td style="padding: 12px 15px;">
            ${formattedDate}
          </td>
          <td style="padding: 12px 15px;">
            <button class="btn btn-outline btn-sm view-user-btn" data-id="${user.id}" style="padding: 4px 8px; font-size: 12px;">
              <span class="material-icons" style="font-size: 16px;">visibility</span>
              View
            </button>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
      
      // Update counters
      document.getElementById('showingCount').textContent = `${startIndex + 1}-${endIndex}`;
      document.getElementById('totalCount').textContent = usersToDisplay.length;
      
      // Update pagination buttons
      document.getElementById('prevPageBtn').disabled = currentPage === 1;
      document.getElementById('nextPageBtn').disabled = endIndex >= usersToDisplay.length;
      
      // Add event listeners to view buttons
      document.querySelectorAll('.view-user-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const userId = this.dataset.id;
          const user = allUsers.find(u => u.id === userId);
          if (user) {
            showUserDetails(user);
          }
        });
      });
    }

    // Load transactions table
    function loadTransactionsTable(filtered = false) {
      const transactionsToDisplay = filtered ? filteredTransactions : allTransactions;
      const startIndex = (currentPage - 1) * itemsPerPage;
      const endIndex = Math.min(startIndex + itemsPerPage, transactionsToDisplay.length);
      const paginatedTransactions = transactionsToDisplay.slice(startIndex, endIndex);
      
      const tableBody = document.getElementById('transactionsTableBody');
      tableBody.innerHTML = '';
      
      paginatedTransactions.forEach(transaction => {
        let statusClass = '';
        let statusIcon = '';
        
        if (transaction.status === 'completed') {
          statusClass = 'normal';
          statusIcon = '🟢';
        } else if (transaction.status === 'pending') {
          statusClass = 'warning';
          statusIcon = '🟡';
        } else {
          statusClass = 'alert';
          statusIcon = '🔴';
        }
        
        const transactionDate = new Date(transaction.date);
        const formattedDate = transactionDate.toLocaleDateString();
        const formattedTime = transactionDate.toLocaleTimeString();
        
        const row = document.createElement('tr');
        row.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
        row.style.transition = 'var(--transition)';
        row.innerHTML = `
          <td style="padding: 12px 15px;">
            <input type="checkbox" class="transaction-checkbox" data-id="${transaction.id}" ${selectedTransactions.has(transaction.id) ? 'checked' : ''}>
          </td>
          <td style="padding: 12px 15px;">${transaction.id}</td>
          <td style="padding: 12px 15px;">
            <div>${transaction.userName}</div>
            <div style="font-size: 12px; color: var(--gray);">${transaction.userId}</div>
          </td>
          <td style="padding: 12px 15px;">${transaction.type.charAt(0).toUpperCase() + transaction.type.slice(1)}</td>
          <td style="padding: 12px 15px;">
            $${transaction.amount.toLocaleString()}
          </td>
          <td style="padding: 12px 15px;">
            <div>From: ${transaction.from}</div>
            <div>To: ${transaction.to}</div>
          </td>
          <td style="padding: 12px 15px;">
            <div>${formattedDate}</div>
            <div style="font-size: 12px; color: var(--gray);">${formattedTime}</div>
          </td>
          <td style="padding: 12px 15px;">
            <span class="user-status ${statusClass}">
              <span class="status-icon">${statusIcon}</span>
              ${transaction.status.charAt(0).toUpperCase() + transaction.status.slice(1)}
            </span>
          </td>
          <td style="padding: 12px 15px;">
            <button class="btn btn-outline btn-sm view-transaction-btn" data-id="${transaction.id}" style="padding: 4px 8px; font-size: 12px;">
              <span class="material-icons" style="font-size: 16px;">visibility</span>
              View
            </button>
          </td>
        `;
        
        tableBody.appendChild(row);
      });
      
      // Update counters
      document.getElementById('transactionsShowingCount').textContent = `${startIndex + 1}-${endIndex}`;
      document.getElementById('transactionsTotalCount').textContent = transactionsToDisplay.length;
      
      // Update pagination buttons
      document.getElementById('transactionsPrevPageBtn').disabled = currentPage === 1;
      document.getElementById('transactionsNextPageBtn').disabled = endIndex >= transactionsToDisplay.length;
      
      // Show/hide flag button
      document.getElementById('flagTransactionBtn').style.display = selectedTransactions.size > 0 ? 'flex' : 'none';
      
      // Add event listeners to checkboxes and view buttons
      document.querySelectorAll('.transaction-checkbox').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
          const transactionId = this.dataset.id;
          if (this.checked) {
            selectedTransactions.add(transactionId);
          } else {
            selectedTransactions.delete(transactionId);
          }
          document.getElementById('flagTransactionBtn').style.display = selectedTransactions.size > 0 ? 'flex' : 'none';
        });
      });
      
      document.querySelectorAll('.view-transaction-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const transactionId = this.dataset.id;
          const transaction = allTransactions.find(t => t.id === transactionId);
          if (transaction) {
            showTransactionDetails(transaction);
          }
        });
      });
    }

// Render user cards
function renderUserCards(users) {
  const container = document.getElementById('userCardsContainer');
  container.innerHTML = '';
  
  // Sort by most recent activity first
  const sortedUsers = [...users].sort((a, b) => new Date(b.lastActivity) - new Date(a.lastActivity));
  
  // Limit to 10 most recent users
  const recentUsers = sortedUsers.slice(0, 10);
  
  recentUsers.forEach((user, index) => {
    const riskScore = user.riskScore;
    let statusClass = 'normal';
    let statusText = 'Normal';
    let statusIcon = '🟢';
    
    if (riskScore > 70) {
      statusClass = 'alert';
      statusText = 'High Risk';
      statusIcon = '🔴';
    } else if (riskScore > 40) {
      statusClass = 'warning';
      statusText = 'Medium Risk';
      statusIcon = '🟡';
    }
    
    // Format last activity time
    const lastActivity = new Date(user.lastActivity);
    const formattedTime = lastActivity.toLocaleString();
    
    // Create heatmap cells for transaction amounts
    const heatmapCells = Array(5).fill().map(() => {
      const amount = Math.floor(Math.random() * 5000) + 100;
      let bgColor = '#4caf50';
      let opacity = 0.3;
      let trend = '';
      
      if (amount > 3000) {
        bgColor = '#ff9800';
        opacity = 0.6;
        trend = '<span class="heatmap-trend" style="color: #ff9800;">↑</span>';
      }
      if (amount > 4500) {
        bgColor = '#f44336';
        opacity = 1.0;
        trend = '<span class="heatmap-trend" style="color: #f44336;">↑↑</span>';
      }
      
      return `<div class="heatmap-cell" style="background: ${bgColor}; opacity: ${opacity};">$${amount}${trend}</div>`;
    }).join('');
    
    // Create timeline items for recent activities
    const activities = ['Login', 'Balance Check', 'Fund Transfer', 'Bill Payment', 'Profile Update'];
    const timelineItems = Array(3).fill().map(() => {
      const activity = activities[Math.floor(Math.random() * activities.length)];
      const time = new Date(lastActivity.getTime() - Math.floor(Math.random() * 24 * 60 * 60 * 1000));
      return `
        <div class="timeline-item">
          <div class="timeline-time">${time.toLocaleTimeString()}</div>
          <div class="timeline-content">
            <div class="timeline-action">${activity}</div>
            <div class="timeline-details">
              <div class="timeline-detail">${user.device}</div>
              <div class="timeline-detail">${user.location}</div>
            </div>
          </div>
        </div>
      `;
    }).join('');
    
    // Calculate gauge offset
    const gaugeOffset = 314 * (riskScore / 100);
    
    // Create user card
    const card = document.createElement('div');
    card.className = `user-card ${statusClass}`;
    card.style.animationDelay = `${index * 0.05}s`;
    card.dataset.id = user.id;
    card.innerHTML = `
      <div class="user-header">
        <div class="user-title">
          ${user.name}
          <span class="user-status ${statusClass}">
            <span class="status-icon">${statusIcon}</span>
            ${statusText}
          </span>
        </div>
        <div class="user-meta">
          <span class="material-icons">schedule</span>
          <span>Last activity: ${formattedTime}</span>
        </div>
      </div>
      <div class="user-body">
        <div>
          <div class="user-stats">
            <div class="user-stat">
              <div class="user-stat-value">${user.accounts}</div>
              <div class="user-stat-label">Accounts</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value">${user.transactions}</div>
              <div class="user-stat-label">Transactions</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value">${user.loginAttempts}</div>
              <div class="user-stat-label">Failed Logins</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value">${user.accountType}</div>
              <div class="user-stat-label">Account Type</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value">${user.device}</div>
              <div class="user-stat-label">Device</div>
            </div>
            <div class="user-stat">
              <div class="user-stat-value">${user.location}</div>
              <div class="user-stat-label">Location</div>
            </div>
          </div>
          <div>
            <h4>Recent Transactions</h4>
            <div class="heatmap">
              ${heatmapCells}
            </div>
          </div>
          <div class="user-location-map" id="map-${user.id}"></div>
        </div>
        <div>
          <div style="text-align: center;">
            <div class="risk-gauge ${riskScore <= 30 ? 'low-risk' : ''}">
              <svg width="100%" height="100%" viewBox="0 0 120 120">
                <circle class="gauge-bg" cx="60" cy="60" r="50"></circle>
                <circle class="gauge-fill" cx="60" cy="60" r="50" stroke-dasharray="314" stroke-dashoffset="${gaugeOffset}"></circle>
              </svg>
              <div class="gauge-text">${riskScore}</div>
            </div>
            <div class="gauge-label">Risk Score</div>
          </div>
          <div class="timeline">
            ${timelineItems}
          </div>
        </div>
      </div>
    `;
    
    // Add click event to show details
    card.addEventListener('click', () => {
      showUserDetails(user);
    });
    
    container.appendChild(card);

    // Initialize Leaflet map after card is in DOM
    const map = L.map(`map-${user.id}`, {
      zoomControl: false,
      attributionControl: false
    }).setView([51.505, -0.09], 5);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

    const cityCoords = {
      "New York": [40.7128, -74.0060],
      "London": [51.5074, -0.1278],
      "Tokyo": [35.6762, 139.6503],
      "Sydney": [-33.8688, 151.2093],
      "Berlin": [52.5200, 13.4050]
    };

    if (cityCoords[user.location]) {
      map.setView(cityCoords[user.location], 11);
      L.marker(cityCoords[user.location]).addTo(map)
        .bindPopup(`${user.name} (${user.location})`);
    }
  });
}


    // Show user details modal
    function showUserDetails(user) {
      const modal = document.getElementById('userModal');
      const jsonViewer = document.getElementById('userJsonViewer');
      
      // Format JSON with syntax highlighting
      const formattedJson = JSON.stringify(user, null, 2)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
          let cls = 'number';
          if (/^"/.test(match)) {
            if (/:$/.test(match)) {
              cls = 'key';
            } else {
              cls = 'string';
            }
          } else if (/true|false/.test(match)) {
            cls = 'boolean';
          } else if (/null/.test(match)) {
            cls = 'null';
          }
          return `<span class="${cls}">${match}</span>`;
        });
      
      jsonViewer.innerHTML = formattedJson;
      modal.style.display = 'block';
      
      // Add style for syntax highlighting
      const style = document.createElement('style');
      style.textContent = `
        .json-viewer .string { color: #5a8ec9; }
        .json-viewer .number { color: #ff9800; }
        .json-viewer .boolean { color: #f44336; }
        .json-viewer .null { color: #f44336; }
        .json-viewer .key { color: #2c5aa0; }
      `;
      jsonViewer.appendChild(style);
    }

    // Show transaction details modal
    function showTransactionDetails(transaction) {
      const modal = document.getElementById('userModal');
      const jsonViewer = document.getElementById('userJsonViewer');
      
      // Update modal title
      document.querySelector('.modal-title').textContent = 'Transaction Details';
      
      // Format JSON with syntax highlighting
      const formattedJson = JSON.stringify(transaction, null, 2)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g, match => {
          let cls = 'number';
          if (/^"/.test(match)) {
            if (/:$/.test(match)) {
              cls = 'key';
            } else {
              cls = 'string';
            }
          } else if (/true|false/.test(match)) {
            cls = 'boolean';
          } else if (/null/.test(match)) {
            cls = 'null';
          }
          return `<span class="${cls}">${match}</span>`;
        });
      
      jsonViewer.innerHTML = formattedJson;
      modal.style.display = 'block';
      
      // Add style for syntax highlighting
      const style = document.createElement('style');
      style.textContent = `
        .json-viewer .string { color: #5a8ec9; }
        .json-viewer .number { color: #ff9800; }
        .json-viewer .boolean { color: #f44336; }
        .json-viewer .null { color: #f44336; }
        .json-viewer .key { color: #2c5aa0; }
      `;
      jsonViewer.appendChild(style);
    }

    // Close modal
    function closeModal() {
      document.getElementById('userModal').style.display = 'none';
      document.querySelector('.modal-title').textContent = 'User Details';
    }

    // Filter users
    function filterUsers() {
      const dateFrom = document.getElementById('dateFrom').value;
      const dateTo = document.getElementById('dateTo').value;
      const riskScoreThreshold = parseInt(document.getElementById('riskScoreRange').value);
      const activityType = document.getElementById('activityType').value;
      const activityStatus = document.getElementById('activityStatus').value;
      
      filteredUsers = allUsers.filter(user => {
        // Filter by date range
        if (dateFrom || dateTo) {
          const userDate = new Date(user.lastActivity).toISOString().split('T')[0];
          if (dateFrom && userDate < dateFrom) return false;
          if (dateTo && userDate > dateTo) return false;
        }
        
        // Filter by risk score
        if (user.riskScore > riskScoreThreshold) return false;
        
        // Note: Activity type and status filtering would require more detailed user data
        // For now, we'll just return true for these filters
        return true;
      });
      
      renderUserCards(filteredUsers);
      document.getElementById('advancedFilters').classList.remove('active');
    }

    // Filter users for table view
    function filterUsersTable() {
      const dateFrom = document.getElementById('usersDateFrom').value;
      const dateTo = document.getElementById('usersDateTo').value;
      const riskScoreThreshold = parseInt(document.getElementById('usersRiskScoreRange').value);
      const status = document.getElementById('usersStatus').value;
      const accountType = document.getElementById('usersAccountType').value;
      
      filteredUsers = allUsers.filter(user => {
        // Filter by date range
        if (dateFrom || dateTo) {
          const userDate = new Date(user.lastActivity).toISOString().split('T')[0];
          if (dateFrom && userDate < dateFrom) return false;
          if (dateTo && userDate > dateTo) return false;
        }
        
        // Filter by risk score
        if (user.riskScore > riskScoreThreshold) return false;
        
        // Filter by status
        if (status && user.status !== status) return false;
        
        // Filter by account type
        if (accountType && user.accountType !== accountType) return false;
        
        return true;
      });
      
      currentPage = 1;
      loadUsersTable(true);
      document.getElementById('usersAdvancedFilters').classList.remove('active');
    }

    // Filter transactions for table view
    function filterTransactionsTable() {
      const dateFrom = document.getElementById('transactionsDateFrom').value;
      const dateTo = document.getElementById('transactionsDateTo').value;
      const amountFrom = parseInt(document.getElementById('amountFrom').value) || 0;
      const amountTo = parseInt(document.getElementById('amountTo').value) || Number.MAX_SAFE_INTEGER;
      const transactionType = document.getElementById('transactionType').value;
      const transactionStatus = document.getElementById('transactionStatus').value;
      
      filteredTransactions = allTransactions.filter(transaction => {
        // Filter by date range
        if (dateFrom || dateTo) {
          const transactionDate = new Date(transaction.date).toISOString().split('T')[0];
          if (dateFrom && transactionDate < dateFrom) return false;
          if (dateTo && transactionDate > dateTo) return false;
        }
        
        // Filter by amount range
        if (transaction.amount < amountFrom || transaction.amount > amountTo) return false;
        
        // Filter by transaction type
        if (transactionType && transaction.type !== transactionType) return false;
        
        // Filter by status
        if (transactionStatus && transaction.status !== transactionStatus) return false;
        
        return true;
      });
      
      currentPage = 1;
      loadTransactionsTable(true);
      document.getElementById('transactionsAdvancedFilters').classList.remove('active');
    }

    // Export user data
    function exportUserData() {
      Swal.fire({
        title: 'Export Users',
        text: 'Would you like to export all users or just the filtered ones?',
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Filtered Users',
        cancelButtonText: 'All Users',
        showDenyButton: true,
        denyButtonText: 'Cancel'
      }).then((result) => {
        if (result.isConfirmed) {
          // Export filtered users
          const dataStr = JSON.stringify(filteredUsers, null, 2);
          downloadJson(dataStr, `banksecure-filtered-users-${new Date().toISOString()}.json`);
        } else if (result.isDismissed) {
          // Export all users
          const dataStr = JSON.stringify(allUsers, null, 2);
          downloadJson(dataStr, `banksecure-all-users-${new Date().toISOString()}.json`);
        }
      });
    }

    // Export users table data
    function exportUsersTableData() {
      const usersToExport = filteredUsers.length > 0 ? filteredUsers : allUsers;
      
      Swal.fire({
        title: 'Export Users',
        text: `Preparing to export ${usersToExport.length} users. Continue?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Export',
        cancelButtonText: 'Cancel'
      }).then((result) => {
        if (result.isConfirmed) {
          const dataStr = JSON.stringify(usersToExport, null, 2);
          downloadJson(dataStr, `banksecure-users-${new Date().toISOString()}.json`);
        }
      });
    }

    // Export transactions table data
    function exportTransactionsTableData() {
      const transactionsToExport = filteredTransactions.length > 0 ? filteredTransactions : allTransactions;
      
      Swal.fire({
        title: 'Export Transactions',
        text: `Preparing to export ${transactionsToExport.length} transactions. Continue?`,
        icon: 'question',
        showCancelButton: true,
        confirmButtonText: 'Export',
        cancelButtonText: 'Cancel'
      }).then((result) => {
        if (result.isConfirmed) {
          const dataStr = JSON.stringify(transactionsToExport, null, 2);
          downloadJson(dataStr, `banksecure-transactions-${new Date().toISOString()}.json`);
        }
      });
    }

    // Flag selected transactions
    function flagSelectedTransactions() {
      Swal.fire({
        title: 'Flag Transactions',
        text: `Are you sure you want to flag ${selectedTransactions.size} selected transactions as suspicious?`,
        icon: 'warning',
        showCancelButton: true,
        confirmButtonText: 'Flag',
        cancelButtonText: 'Cancel',
        confirmButtonColor: '#ff9800'
      }).then((result) => {
        if (result.isConfirmed) {
          // Update transaction status to flagged
          allTransactions.forEach(transaction => {
            if (selectedTransactions.has(transaction.id)) {
              transaction.status = 'flagged';
            }
          });
          
          // Clear selection
          selectedTransactions.clear();
          
          // Reload table
          loadTransactionsTable(filteredTransactions.length > 0);
          
          // Show success message
          Swal.fire({
            title: 'Flagged!',
            text: 'Selected transactions have been flagged as suspicious.',
            icon: 'success'
          });
        }
      });
    }

    // Download JSON file
    function downloadJson(dataStr, filename) {
      const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
      const linkElement = document.createElement('a');
      linkElement.setAttribute('href', dataUri);
      linkElement.setAttribute('download', filename);
      linkElement.click();
    }

    // Set up event listeners
    function setupEventListeners() {
      // Search functionality with debounce
      let searchTimeout;
      document.getElementById('searchInput').addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
          const searchTerm = e.target.value.toLowerCase();
          filteredUsers = allUsers.filter(user => 
            user.id.toLowerCase().includes(searchTerm) ||
            user.name.toLowerCase().includes(searchTerm) ||
            user.email.toLowerCase().includes(searchTerm) ||
            user.accountType.toLowerCase().includes(searchTerm) ||
            user.location.toLowerCase().includes(searchTerm)
          );
          renderUserCards(filteredUsers);
        }, 300);
      });
      
      // Auto-refresh toggle
      document.getElementById('autoRefreshBtn').addEventListener('click', function() {
        this.classList.toggle('active');
        if (this.classList.contains('active')) {
          startAutoRefresh();
        } else {
          stopAutoRefresh();
        }
      });
      
      // Filter buttons
      document.getElementById('filterBtn').addEventListener('click', function() {
        document.getElementById('advancedFilters').classList.toggle('active');
      });
      
      document.getElementById('usersFilterBtn').addEventListener('click', function() {
        document.getElementById('usersAdvancedFilters').classList.toggle('active');
      });
      
      document.getElementById('transactionsFilterBtn').addEventListener('click', function() {
        document.getElementById('transactionsAdvancedFilters').classList.toggle('active');
      });
      
      // Apply filters
      document.getElementById('applyFilters').addEventListener('click', filterUsers);
      document.getElementById('usersApplyFilters').addEventListener('click', filterUsersTable);
      document.getElementById('transactionsApplyFilters').addEventListener('click', filterTransactionsTable);
      
      // Reset filters
      document.getElementById('resetFilters').addEventListener('click', function() {
        document.getElementById('dateFrom').value = '';
        document.getElementById('dateTo').value = '';
        document.getElementById('riskScoreRange').value = 30;
        document.getElementById('riskScoreValue').textContent = '30+';
        document.getElementById('activityType').value = '';
        document.getElementById('activityStatus').value = '';
        
        filteredUsers = [...allUsers];
        renderUserCards(filteredUsers);
        document.getElementById('advancedFilters').classList.remove('active');
      });
      
      document.getElementById('usersResetFilters').addEventListener('click', function() {
        document.getElementById('usersDateFrom').value = '';
        document.getElementById('usersDateTo').value = '';
        document.getElementById('usersRiskScoreRange').value = 30;
        document.getElementById('usersRiskScoreValue').textContent = '30+';
        document.getElementById('usersStatus').value = '';
        document.getElementById('usersAccountType').value = '';
        
        filteredUsers = [...allUsers];
        currentPage = 1;
        loadUsersTable();
        document.getElementById('usersAdvancedFilters').classList.remove('active');
      });
      
      document.getElementById('transactionsResetFilters').addEventListener('click', function() {
        document.getElementById('transactionsDateFrom').value = '';
        document.getElementById('transactionsDateTo').value = '';
        document.getElementById('amountFrom').value = '';
        document.getElementById('amountTo').value = '';
        document.getElementById('transactionType').value = '';
        document.getElementById('transactionStatus').value = '';
        
        filteredTransactions = [...allTransactions];
        currentPage = 1;
        loadTransactionsTable();
        document.getElementById('transactionsAdvancedFilters').classList.remove('active');
      });
      
      // Risk score range input
      document.getElementById('riskScoreRange').addEventListener('input', function() {
        document.getElementById('riskScoreValue').textContent = `${this.value}+`;
      });
      
      document.getElementById('usersRiskScoreRange').addEventListener('input', function() {
        document.getElementById('usersRiskScoreValue').textContent = `${this.value}+`;
      });
      
      // Export buttons
      document.getElementById('exportBtn').addEventListener('click', exportUserData);
      document.getElementById('usersExportBtn').addEventListener('click', exportUsersTableData);
      document.getElementById('transactionsExportBtn').addEventListener('click', exportTransactionsTableData);
      
      // Flag transactions button
      document.getElementById('flagTransactionBtn').addEventListener('click', flagSelectedTransactions);
      
      // Modal close buttons
      document.getElementById('modalClose').addEventListener('click', closeModal);
      document.getElementById('closeModalBtn').addEventListener('click', closeModal);
      
      // Copy JSON button
      document.getElementById('copyJsonBtn').addEventListener('click', function() {
        const jsonViewer = document.getElementById('userJsonViewer');
        const textToCopy = jsonViewer.textContent;
        
        navigator.clipboard.writeText(textToCopy).then(() => {
          Swal.fire({
            title: 'Copied!',
            text: 'User JSON has been copied to clipboard.',
            icon: 'success',
            timer: 2000
          });
        });
      });
      
      // Pagination buttons
      document.getElementById('prevPageBtn').addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          loadUsersTable(filteredUsers.length > 0);
        }
      });
      
      document.getElementById('nextPageBtn').addEventListener('click', function() {
        const totalPages = Math.ceil((filteredUsers.length > 0 ? filteredUsers : allUsers).length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          loadUsersTable(filteredUsers.length > 0);
        }
      });
      
      document.getElementById('transactionsPrevPageBtn').addEventListener('click', function() {
        if (currentPage > 1) {
          currentPage--;
          loadTransactionsTable(filteredTransactions.length > 0);
        }
      });
      
      document.getElementById('transactionsNextPageBtn').addEventListener('click', function() {
        const totalPages = Math.ceil((filteredTransactions.length > 0 ? filteredTransactions : allTransactions).length / itemsPerPage);
        if (currentPage < totalPages) {
          currentPage++;
          loadTransactionsTable(filteredTransactions.length > 0);
        }
      });
      
      // Select all button
      document.getElementById('selectAllBtn').addEventListener('click', function() {
        const usersToSelect = filteredUsers.length > 0 ? filteredUsers : allUsers;
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, usersToSelect.length);
        
        for (let i = startIndex; i < endIndex; i++) {
          selectedUsers.add(usersToSelect[i].id);
        }
        
        loadUsersTable(filteredUsers.length > 0);
      });
      
      document.getElementById('selectAllTransactionsBtn').addEventListener('click', function() {
        const transactionsToSelect = filteredTransactions.length > 0 ? filteredTransactions : allTransactions;
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = Math.min(startIndex + itemsPerPage, transactionsToSelect.length);
        
        for (let i = startIndex; i < endIndex; i++) {
          selectedTransactions.add(transactionsToSelect[i].id);
        }
        
        loadTransactionsTable(filteredTransactions.length > 0);
      });
      
      // Add user button
      document.getElementById('addUserBtn').addEventListener('click', function() {
        Swal.fire({
          title: 'Add New User',
          html: `
            <input type="text" id="swal-input1" class="swal2-input" placeholder="Full Name">
            <input type="email" id="swal-input2" class="swal2-input" placeholder="Email">
            <select id="swal-input3" class="swal2-input">
              <option value="Checking">Checking</option>
              <option value="Savings">Savings</option>
              <option value="Business">Business</option>
              <option value="Premium">Premium</option>
            </select>
          `,
          focusConfirm: false,
          preConfirm: () => {
            return [
              document.getElementById('swal-input1').value,
              document.getElementById('swal-input2').value,
              document.getElementById('swal-input3').value
            ]
          }
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire({
              title: 'User Added!',
              text: 'The new user has been added successfully.',
              icon: 'success'
            });
          }
        });
      });
      
      // Generate report button
      document.getElementById('generateReportBtn').addEventListener('click', function() {
        Swal.fire({
          title: 'Generating Report',
          text: 'Your report is being prepared...',
          icon: 'info',
          timer: 2000,
          showConfirmButton: false
        }).then(() => {
          Swal.fire({
            title: 'Report Ready!',
            text: 'Your report has been generated successfully.',
            icon: 'success'
          });
        });
      });
      
      // Schedule report button
      document.getElementById('scheduleReportBtn').addEventListener('click', function() {
        Swal.fire({
          title: 'Schedule Report',
          html: `
            <select id="swal-input1" class="swal2-input">
              <option value="daily">Daily</option>
              <option value="weekly">Weekly</option>
              <option value="monthly">Monthly</option>
            </select>
            <input type="time" id="swal-input2" class="swal2-input" value="09:00">
          `,
          focusConfirm: false,
          preConfirm: () => {
            return [
              document.getElementById('swal-input1').value,
              document.getElementById('swal-input2').value
            ]
          }
        }).then((result) => {
          if (result.isConfirmed) {
            Swal.fire({
              title: 'Report Scheduled!',
              text: `Your report has been scheduled for ${result.value[0]} delivery at ${result.value[1]}.`,
              icon: 'success'
            });
          }
        });
      });
    }

    // Set up keyboard shortcuts
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        // Focus search bar when / is pressed
        if (e.key === '/' && !e.target.matches('input, textarea, select')) {
          e.preventDefault();
          document.getElementById('searchInput').focus();
        }
        
        // Toggle theme when T is pressed
        if (e.key.toLowerCase() === 't' && !e.target.matches('input, textarea, select')) {
          e.preventDefault();
          themeToggle.click();
        }
        
        // Close modal when Escape is pressed
        if (e.key === 'Escape' && document.getElementById('userModal').style.display === 'block') {
          closeModal();
        }
        
        // Show help when ? is pressed
        if (e.key === '?') {
          e.preventDefault();
          Swal.fire({
            title: 'Keyboard Shortcuts',
            html: `
              <div style="text-align: left;">
                <p><strong>/</strong> - Focus search bar</p>
                <p><strong>T</strong> - Toggle dark mode</p>
                <p><strong>Esc</strong> - Close modal</p>
                <p><strong>?</strong> - Show this help</p>
              </div>
            `,
            icon: 'info'
          });   
        }
      });
    }

    // Auto-refresh functions
    function startAutoRefresh() {
      stopAutoRefresh(); // Clear any existing interval
      autoRefreshInterval = setInterval(loadUserData, 30000);
      document.getElementById('autoRefreshBtn').classList.add('pulse');
    }

    function stopAutoRefresh() {
      if (autoRefreshInterval) {
        clearInterval(autoRefreshInterval);
      }
      document.getElementById('autoRefreshBtn').classList.remove('pulse');
    }
  </script>
</body>
</html>